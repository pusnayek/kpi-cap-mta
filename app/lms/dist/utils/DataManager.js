sap.ui.define(["sap/ui/base/Object","sap/ui/model/json/JSONModel","sap/ui/model/Filter","ui/lms/utils/ServiceUrlProvider","ui/lms/utils/DataManagerUtils"],function(e,n,t,r,o){"use strict";return e.extend("ui.lms.utils.DataManager",{init:function(){this.utils=new o;return this},getSessionUser:function(e,n){$.ajax({method:"POST",contentType:"application/json",url:r.User,async:true,beforeSend:function(e){}}).done(function(n){e(n)}).fail(function(e){n(e)})},loadPopulations:function(e){var n=$.Deferred();var t=[e.filterController.prepareUserFilter(e.userInfo.user)];e.getView().getModel().read("/Populations",{filters:t,success:function(e){n.resolve(e.results)},error:function(e){n.reject(e)}});return n},loadFilters:function(e,n){var t=$.Deferred();var r=[e.filterController.prepareUserFilter(e.userInfo.user),e.filterController.prepareModeFilter(n)];e.getView().getModel().read("/Filters",{filters:r,success:function(e){t.resolve(e.results)},error:function(e){t.reject(e)}});return t},loadClockValues:function(e,n){var t=$.Deferred();e.getView().getModel().read("/EmployeeCompetencies",{urlParameters:{$select:"ProfessionalCompetencyPercentage,RegulationCompetencyPercentage,TotalCompetencyPercentage"},filters:n,success:function(e){if(e.results&&e.results.length>0){var n=e.results[0];t.resolve({Professional:n.ProfessionalCompetencyPercentage,Regulation:n.RegulationCompetencyPercentage,Total:n.TotalCompetencyPercentage})}else{t.resolve({Professional:null,Regulation:null,Total:null})}},error:function(e){t.reject(e)}});return t},downloadXlsContent:function(e,n,t){var r=$.Deferred();var o=this;var l=this.utils.prepareXlsDownloadUrl(e.mode,n);$.ajax({method:"POST",contentType:"application/json",url:l,async:true,data:JSON.stringify(o.utils.prepareXlsDownloadPayload(t)),xhrFields:{responseType:"blob"},beforeSend:function(e){}}).done(function(e,n,t){var o=t.getResponseHeader("content-disposition").split("=")[1];var l=o.substring(1,o.length-1);l=decodeURIComponent(l).replace("#"," ");r.resolve({content:e,filename:l})}).fail(function(e){r.reject(e)});return r},downloadBigXlsContent:function(e,n,t){var r=$.Deferred();var o=$.Deferred();var l=this;var s=this.utils.prepareBigXlsDownloadPostUrl(e.mode,n);$.ajax({method:"POST",contentType:"application/json",url:s,async:true,data:JSON.stringify(l.utils.prepareXlsDownloadPayload(t)),beforeSend:function(e){}}).done(function(e){var n=JSON.parse(e);l.checkBigXlsReady(o,n.token)}).fail(function(e){o.reject(e);r.reject(e)});$.when(o).done(function(e){s=l.utils.prepareBigXlsDownloadGetUrl(e.token);$.ajax({method:"GET",contentType:"application/json",url:s,async:true,xhrFields:{responseType:"blob"},beforeSend:function(e){}}).done(function(e,n,t){var o=t.getResponseHeader("content-disposition").split("=")[1];var l=o.substring(1,o.length-1);l=decodeURIComponent(l).replace("#"," ");r.resolve({content:e,filename:l})}).fail(function(e){r.reject(e)})});return r},checkBigXlsReady:function(e,n){var t=this;jQuery.sap.delayedCall(1e4,t,$.proxy(function(){var r=t.utils.prepareBigXlsDownloadCheckUrl(n);$.ajax({method:"GET",contentType:"application/json",url:r,async:true}).done(function(r){var o=JSON.parse(r);if(o.hasError){e.reject()}else if(o.ready){e.resolve({token:n})}else{t.checkBigXlsReady(e,n)}}).fail(function(n){e.reject(n)})},t))}})},false);
//# sourceMappingURL=DataManager.js.map