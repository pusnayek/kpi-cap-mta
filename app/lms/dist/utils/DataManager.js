sap.ui.define(["sap/ui/base/Object","sap/ui/model/json/JSONModel","sap/ui/model/Filter","ui/lms/utils/ServiceUrlProvider","ui/lms/utils/DataManagerUtils"],function(e,t,o,n,i){"use strict";return e.extend("ui.lms.utils.DataManager",{init:function(){this.utils=new i;return this},getSessionUser:function(e,t){$.ajax({method:"POST",contentType:"application/json",url:n.User,async:true,beforeSend:function(e){}}).done(function(t){e(t)}).fail(function(e){t(e)})},loadPopulations:function(e){var t=$.Deferred();var o=[e.filterController.prepareUserFilter(e.userInfo.user)];e.getView().getModel().read("/Populations",{filters:o,success:function(e){t.resolve(e.results)},error:function(e){t.reject(e)}});return t},loadFilters:function(e,t){var o=$.Deferred();var n=[e.filterController.prepareUserFilter(e.userInfo.user),e.filterController.prepareModeFilter(t)];e.getView().getModel().read("/Filters",{filters:n,success:function(e){o.resolve(e.results)},error:function(e){o.reject(e)}});return o},getFilterAsString:function(e){return e.map(e=>e.sPath.concat(" ").concat("eq").concat(" '").concat(e.oValue1).concat("'")).join(" and ")},loadClockValues:function(e,t){var o=this.getFilterAsString(t);var n="/kpi/EmployeeCompetencies?$apply=filter(#)/groupby((ACTING_USERID,ACTOR),aggregate(PROFESSIONAL_QUALIFIED_COMPETENCY with sum as ProfessionalQaulifiedCompetency,PROFESSIONAL_COMPETENCY with sum as ProfessionalCompetency,REGULATION_QUALIFIED_COMPETENCY with sum as RegulationQaulifiedCompetency,REGULATION_COMPETENCY with sum as RegulationCompetency,TOTAL_QUALIFIED_COMPETENCY with sum as TotalQaulifiedCompetency,TOTAL_COMPETENCY with sum as TotalCompetency))".replace("#",o);return new Promise((e,t)=>{$.get({url:n,success:function(t){if(t.value.length>0){var o=t.value[0];e({Professional:(o.ProfessionalCompetency===0?0:o.ProfessionalQaulifiedCompetency*100/o.ProfessionalCompetency).toFixed(0),Regulation:(o.RegulationCompetency===0?0:o.RegulationQaulifiedCompetency*100/o.RegulationCompetency).toFixed(0),Total:(o.TotalCompetency===0?0:o.TotalQaulifiedCompetency*100/o.TotalCompetency).toFixed(0)})}else{e({Professional:null,Regulation:null,Total:null})}},error:function(e){}})})},getCompentenciesByManagers:function(e,t){var o=this.getFilterAsString(t);var n="/kpi/ByManagers?$apply=filter(#)/groupby((USERID,EMPLOYEEID,FIRSTNAME,LASTNAME,DOMAIN,DEPARTMENT,DIVISION,JOBCODE,JOBGROUP,JOBLOCATION,GROUPBU,EMPLOYEEGROUP,EMPCUSTOMSTATUS,MANAGERUSERID,MANAGERNAME),aggregate(PROFESSIONAL_QUALIFIED_COMPETENCY with sum as ProfessionalQaulifiedCompetency,PROFESSIONAL_COMPETENCY with sum as ProfessionalCompetency,REGULATION_QUALIFIED_COMPETENCY with sum as RegulationQaulifiedCompetency,REGULATION_COMPETENCY with sum as RegulationCompetency,TOTAL_QUALIFIED_COMPETENCY with sum as TotalQaulifiedCompetency,TOTAL_COMPETENCY with sum as TotalCompetency))".replace("#",o);return new Promise((e,t)=>{$.get({url:n,success:function(t){var o=t.value.map(function(e){e.Professional=(e.ProfessionalCompetency===0?0:e.ProfessionalQaulifiedCompetency*100/e.ProfessionalCompetency).toFixed(0);e.Regulation=(e.RegulationCompetency===0?0:e.RegulationQaulifiedCompetency*100/e.RegulationCompetency).toFixed(0);e.Total=(e.TotalCompetency===0?0:e.TotalQaulifiedCompetency*100/e.TotalCompetency).toFixed(0);return e});e(o)},error:function(e){t(e)}})})},getCompentenciesByCompetencies:function(e,t){var o=this.getFilterAsString(t);var n="/kpi/ByCompetencies?$apply=filter(#)/groupby((COMPETENCY_ID,COMPETENCY_NAME,COMPETENCY_AREA,COMPETENCY_TYPE,COMPETENCY_DESCRIPTION,COMPETENCY_GRANTSCERTIFICATE,RETAININGNUMER),aggregate(NUMBER_OF_EMPLOYEES%20with%20sum%20as%20NumberOfEmployees,NUMBER_OF_QUALIFIED_EMPLOYEES%20with%20sum%20as%20NumberOfQualifiedEmployees))".replace("#",o);return new Promise((e,t)=>{$.get({url:n,success:function(t){var o=t.value.map(function(e){e.QaulificationPercentage=(e.NumberOfEmployees===0?0:e.NumberOfQualifiedEmployees*100/e.NumberOfEmployees).toFixed(0);return e});e(o)},error:function(e){t(e)}})})},getCompentenciesByEmployees:function(e,t){var o=this.getFilterAsString(t);var n="/kpi/EmployeeCompetencies?$apply=filter(#)/groupby((USERID,EMPLOYEEID,FIRSTNAME,LASTNAME,DOMAIN,DEPARTMENT,DIVISION,JOBCODE,JOBGROUP,JOBLOCATION,GROUPBU,EMPLOYEEGROUP,EMPCUSTOMSTATUS,MANAGERUSERID,MANAGERNAME),aggregate(PROFESSIONAL_QUALIFIED_COMPETENCY with sum as ProfessionalQaulifiedCompetency,PROFESSIONAL_COMPETENCY with sum as ProfessionalCompetency,REGULATION_QUALIFIED_COMPETENCY with sum as RegulationQaulifiedCompetency,REGULATION_COMPETENCY with sum as RegulationCompetency,TOTAL_QUALIFIED_COMPETENCY with sum as TotalQaulifiedCompetency,TOTAL_COMPETENCY with sum as TotalCompetency))".replace("#",o);return new Promise((e,t)=>{$.get({url:n,success:function(t){var o=t.value.map(function(e){e.Professional=(e.ProfessionalCompetency===0?0:e.ProfessionalQaulifiedCompetency*100/e.ProfessionalCompetency).toFixed(0);e.Regulation=(e.RegulationCompetency===0?0:e.RegulationQaulifiedCompetency*100/e.RegulationCompetency).toFixed(0);e.Total=(e.TotalCompetency===0?0:e.TotalQaulifiedCompetency*100/e.TotalCompetency).toFixed(0);return e});e(o)},error:function(e){t(e)}})})},getCompentenciesByCompanies:function(e,t){var o=this.getFilterAsString(t);var n="/kpi/EmployeeCompetencies?$apply=filter(#)/groupby((DOMAIN),aggregate(PROFESSIONAL_QUALIFIED_COMPETENCY with sum as ProfessionalQaulifiedCompetency,PROFESSIONAL_COMPETENCY with sum as ProfessionalCompetency,REGULATION_QUALIFIED_COMPETENCY with sum as RegulationQaulifiedCompetency,REGULATION_COMPETENCY with sum as RegulationCompetency,TOTAL_QUALIFIED_COMPETENCY with sum as TotalQaulifiedCompetency,TOTAL_COMPETENCY with sum as TotalCompetency))".replace("#",o);return new Promise((e,t)=>{$.get({url:n,success:function(t){var o=t.value.map(function(e){e.Professional=(e.ProfessionalCompetency===0?0:e.ProfessionalQaulifiedCompetency*100/e.ProfessionalCompetency).toFixed(0);e.Regulation=(e.RegulationCompetency===0?0:e.RegulationQaulifiedCompetency*100/e.RegulationCompetency).toFixed(0);e.Total=(e.TotalCompetency===0?0:e.TotalQaulifiedCompetency*100/e.TotalCompetency).toFixed(0);return e});e(o)},error:function(e){t(e)}})})},getCompentenciesByDivisions:function(e,t){var o=this.getFilterAsString(t);var n="/kpi/EmployeeCompetencies?$apply=filter(#)/groupby((DIVISION),aggregate(PROFESSIONAL_QUALIFIED_COMPETENCY with sum as ProfessionalQaulifiedCompetency,PROFESSIONAL_COMPETENCY with sum as ProfessionalCompetency,REGULATION_QUALIFIED_COMPETENCY with sum as RegulationQaulifiedCompetency,REGULATION_COMPETENCY with sum as RegulationCompetency,TOTAL_QUALIFIED_COMPETENCY with sum as TotalQaulifiedCompetency,TOTAL_COMPETENCY with sum as TotalCompetency))".replace("#",o);return new Promise((e,t)=>{$.get({url:n,success:function(t){var o=t.value.map(function(e){e.Professional=(e.ProfessionalCompetency===0?0:e.ProfessionalQaulifiedCompetency*100/e.ProfessionalCompetency).toFixed(0);e.Regulation=(e.RegulationCompetency===0?0:e.RegulationQaulifiedCompetency*100/e.RegulationCompetency).toFixed(0);e.Total=(e.TotalCompetency===0?0:e.TotalQaulifiedCompetency*100/e.TotalCompetency).toFixed(0);return e});e(o)},error:function(e){t(e)}})})},getCompentenciesByDepartments:function(e,t){var o=this.getFilterAsString(t);var n="/kpi/EmployeeCompetencies?$apply=filter(#)/groupby((DEPARTMENT),aggregate(PROFESSIONAL_QUALIFIED_COMPETENCY with sum as ProfessionalQaulifiedCompetency,PROFESSIONAL_COMPETENCY with sum as ProfessionalCompetency,REGULATION_QUALIFIED_COMPETENCY with sum as RegulationQaulifiedCompetency,REGULATION_COMPETENCY with sum as RegulationCompetency,TOTAL_QUALIFIED_COMPETENCY with sum as TotalQaulifiedCompetency,TOTAL_COMPETENCY with sum as TotalCompetency))".replace("#",o);return new Promise((e,t)=>{$.get({url:n,success:function(t){var o=t.value.map(function(e){e.Professional=(e.ProfessionalCompetency===0?0:e.ProfessionalQaulifiedCompetency*100/e.ProfessionalCompetency).toFixed(0);e.Regulation=(e.RegulationCompetency===0?0:e.RegulationQaulifiedCompetency*100/e.RegulationCompetency).toFixed(0);e.Total=(e.TotalCompetency===0?0:e.TotalQaulifiedCompetency*100/e.TotalCompetency).toFixed(0);return e});e(o)},error:function(e){t(e)}})})},downloadXlsContent:function(e,t,o){var n=$.Deferred();var i=this;var a=this.utils.prepareXlsDownloadUrl(e.mode,t);$.ajax({method:"POST",contentType:"application/json",url:a,async:true,data:JSON.stringify(i.utils.prepareXlsDownloadPayload(o)),xhrFields:{responseType:"blob"},beforeSend:function(e){}}).done(function(e,t,o){var i=o.getResponseHeader("content-disposition").split("=")[1];var a=i.substring(1,i.length-1);a=decodeURIComponent(a).replace("#"," ");n.resolve({content:e,filename:a})}).fail(function(e){n.reject(e)});return n},downloadXls:function(e,t,o){var n=$.Deferred();var i=this;var a="/excel/download";var s={user:e.userInfo.user,mode:e.mode,scenario:t,filters:o};$.ajax({method:"POST",contentType:"application/json",url:a,data:JSON.stringify(s),async:true,xhrFields:{responseType:"blob"},beforeSend:function(e){}}).done(function(e,t,o){var i=o.getResponseHeader("content-disposition").split("=")[1];n.resolve({content:e,filename:i})}).fail(function(e){n.reject(e)});return n},downloadBigXlsContent:function(e,t,o){var n=$.Deferred();var i=$.Deferred();var a=this;var s=this.utils.prepareBigXlsDownloadPostUrl(e.mode,t);$.ajax({method:"POST",contentType:"application/json",url:s,async:true,data:JSON.stringify(a.utils.prepareXlsDownloadPayload(o)),beforeSend:function(e){}}).done(function(e){var t=JSON.parse(e);a.checkBigXlsReady(i,t.token)}).fail(function(e){i.reject(e);n.reject(e)});$.when(i).done(function(e){s=a.utils.prepareBigXlsDownloadGetUrl(e.token);$.ajax({method:"GET",contentType:"application/json",url:s,async:true,xhrFields:{responseType:"blob"},beforeSend:function(e){}}).done(function(e,t,o){var i=o.getResponseHeader("content-disposition").split("=")[1];var a=i.substring(1,i.length-1);a=decodeURIComponent(a).replace("#"," ");n.resolve({content:e,filename:a})}).fail(function(e){n.reject(e)})});return n},checkBigXlsReady:function(e,t){var o=this;jQuery.sap.delayedCall(1e4,o,$.proxy(function(){var n=o.utils.prepareBigXlsDownloadCheckUrl(t);$.ajax({method:"GET",contentType:"application/json",url:n,async:true}).done(function(n){var i=JSON.parse(n);if(i.hasError){e.reject()}else if(i.ready){e.resolve({token:t})}else{o.checkBigXlsReady(e,t)}}).fail(function(t){e.reject(t)})},o))}})},false);
//# sourceMappingURL=DataManager.js.map